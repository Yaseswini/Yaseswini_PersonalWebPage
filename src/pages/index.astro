import Layout from '../layouts/Layout.astro'

import { profile } from '@/settings'
import { publications, experiences, education } from '@/data/cv'
import ProfilePictures from '@/assets/profile_pictures.jpg'
import Hero from '@/components/ui/Hero.astro'
import Grid from '@/components/ui/Grid.astro'
import ArticleList from '@/components/ui/ArticleList.astro'
import CvTimeline from '@/components/ui/CvTimeline.astro'

import type { Experience, Education } from '../types/cv'

let orderedExperiences: Experience[] = []
let orderedEducations: Education[] = []

// Function to order elements based on time
const orderElement = <T extends { time: string }>(a: T, b: T) => {
  const presentValues = ['present', 'now', 'current', 'today']
  if (presentValues.includes((a['time'] as string)?.split(' - ')[1]?.toLowerCase())) {
    return -1 // If the date is 'present', it should be the first element
  }
  const dateA = new Date((a['time'] as string)?.split(' - ')[1])
  const dateB = new Date((b['time'] as string)?.split(' - ')[1])
  return dateB.getTime() - dateA.getTime()
}

// Sort experiences and education
if (experiences.length > 0) {
  orderedExperiences = experiences.sort((a, b) => orderElement(a, b))
}

if (education.length > 0) {
  orderedEducations = education.sort((a, b) => orderElement(a, b))
}

const { fullName, title, institute, research_areas } = profile

---

<Layout>
  <!-- Hero Section -->
  <section class="flex items-center gap-12 border-b pb-12">
    <Hero
      fullName={fullName}
      title={title}
      institute={institute}
      profilePicture={ProfilePictures}
    />
  </section>

  <!-- Research Areas -->
  <section class="py-12 border-b">
    <Grid gridTitle="Research Areas" gridItems={research_areas} />
  </section>

  <!-- Recent Publications -->
  <section class="py-12 border-t">
    <ArticleList listTitle="Recent Publications" listItems={publications} />
  </section>

  {/* Education Section */}
  {orderedEducations.length > 0 && (
    <section class="mb-12">
      <h2 class="text-2xl font-bold mb-6 border-b pb-2">Education</h2>
      <CvTimeline elements={orderedEducations} colored={true} />
    </section>
  )}

  {/* Experiences Section */}
  {orderedExperiences.length > 0 && (
    <section class="mb-12">
      <h2 class="text-2xl font-bold mb-6 border-b pb-2">Experiences</h2>
      <CvTimeline elements={orderedExperiences} colored={true} />
    </section>
  )}
</Layout>
